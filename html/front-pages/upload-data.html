<!DOCTYPE html>
<html lang="en" class="layout-navbar-fixed layout-wide" dir="ltr" data-assets-path="../../assets/"
  data-template="front-pages" data-bs-theme="light">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Upload Geospatial Data | TemaDigital Data Portal</title>
  <link rel="icon" type="image/x-icon" href="../../assets/img/favicon/favicon.ico">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&amp;display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="../../assets/vendor/fonts/iconify-icons.css">
  <link rel="stylesheet" href="../../assets/vendor/css/core.css">
  <link rel="stylesheet" href="../../assets/css/demo.css">
  <link rel="stylesheet" href="../../assets/vendor/css/pages/front-page.css">

  <!-- Leaflet CSS & JS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

  <script src="../../assets/vendor/js/helpers.js"></script>
  <script src="../../assets/js/front-config.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
    }

    .split-layout {
      display: flex;
      height: 100vh;
      width: 100vw;
      background-color: #f8f9fa;
    }

    .left-panel {
      width: 420px;
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
      background: white;
      z-index: 10;
      box-shadow: 4px 0 15px rgba(0, 0, 0, 0.05);
      border-right: 1px solid #d9dee3;
    }

    .right-panel {
      flex-grow: 1;
      position: relative;
    }

    .left-header {
      min-height: 64px;
      border-bottom: 1px solid #d9dee3;
      display: flex;
      align-items: center;
      padding: 0 1rem;
      background: #fff;
    }

    .left-header input.project-name-input {
      border: 1px solid transparent;
      box-shadow: none;
      font-size: 1.1rem;
      font-weight: 500;
      padding: 0.25rem 0.5rem;
      border-radius: 6px;
      transition: 0.2s ease;
    }

    .left-header input.project-name-input:focus,
    .left-header input.project-name-input:hover {
      border-color: #696cff;
      background: #f8f9fa;
    }

    .left-content {
      flex-grow: 1;
      overflow-y: auto;
      padding: 1.5rem;
    }

    .left-footer {
      min-height: 70px;
      border-top: 1px solid #d9dee3;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 1.5rem;
      background: #fff;
    }

    /* Target screenshot mimicry styles */
    .upload-card {
      border: 1px dashed #d9dee3;
      border-radius: 8px;
      padding: 1.25rem;
      text-align: center;
      cursor: pointer;
      background: #fff;
      transition: all 0.2s ease;
      position: relative;
    }

    .upload-card:hover {
      border-color: #696cff;
      background: #fbfbff;
    }

    .upload-card.active {
      border: 2px solid #5a5ce6;
      background: #f4f5ff;
    }

    .upload-card-icon {
      font-size: 2.5rem;
      color: #566a7f;
      margin-bottom: 0.5rem;
      display: block;
    }

    .upload-card.active .upload-card-icon {
      color: #696cff;
    }

    .upload-card-title {
      color: #696cff;
      font-weight: 500;
      margin-bottom: 0.2rem;
    }

    .upload-card-text {
      font-size: 0.9rem;
      color: #697a8d;
    }

    .upload-card-text small {
      font-size: 0.8rem;
      color: #a1acb8;
    }

    .question-mark {
      position: absolute;
      top: 10px;
      right: 15px;
      color: #a1acb8;
      font-size: 1.1rem;
    }

    .form-section-title {
      font-size: 1.05rem;
      font-weight: 700;
      color: #32475c;
      margin-bottom: 0.5rem;
      margin-top: 2rem;
    }

    .auto-mode-btn {
      background-color: #f1f1f2;
      color: #4b4b4b;
      border: 1px solid #d9dee3;
      font-weight: 500;
    }

    .auto-mode-btn:hover {
      background-color: #e6e6e8;
    }

    .zip-upload-zone {
      display: none;
      margin-top: 1rem;
    }

    .zip-upload-zone.active {
      display: block;
    }

    .help-text {
      font-size: 0.85rem;
      color: #697a8d;
      margin-bottom: 1rem;
    }

    /* Set Position Modal Styles */
    .set-position-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1050;
      align-items: center;
      justify-content: center;
    }

    .set-position-modal.show {
      display: flex;
    }

    .modal-content-custom {
      background: #fff;
      width: 95%;
      max-width: 1300px;
      height: 90vh;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }

    .modal-header-custom {
      padding: 1.5rem;
      border-bottom: 1px solid #e9ecef;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-body-custom {
      padding: 1.5rem;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
    }

    .modal-footer-custom {
      padding: 1rem 1.5rem;
      border-top: 1px solid #e9ecef;
      display: flex;
      justify-content: flex-end;
      gap: 1rem;
    }

    .stats-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 1.5rem;
      font-size: 0.9rem;
    }

    .stats-table th,
    .stats-table td {
      padding: 0.75rem 1rem;
      text-align: center;
      border-bottom: 1px solid #e9ecef;
    }

    .stats-table th {
      background: #f1f5f9;
      color: #475569;
      font-weight: 600;
    }

    .modal-map-container {
      flex-grow: 1;
      min-height: 350px;
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid #e9ecef;
    }

    #modalMap {
      width: 100%;
      height: 100%;
    }

    /* Adjust map controls */
    .leaflet-control-zoom {
      border: none !important;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1) !important;
    }

    .leaflet-bar a {
      color: #696cff !important;
      border-radius: 4px !important;
      margin-bottom: 4px !important;
      border-bottom: none !important;
    }
  </style>
</head>

<body>
  <div class="split-layout">

    <!-- Left Sidebar: Form -->
    <div class="left-panel">
      <!-- Top header with back button and project title -->
      <div class="left-header">
        <a href="landing-page.html" class="text-body d-flex align-items-center me-3 p-2 rounded-circle hover-bg-light">
          <i class="bx bx-chevron-left fs-4"></i>
        </a>
        <input type="text" class="form-control project-name-input w-100" id="projectTitle" name="projectTitle"
          placeholder="ProjectName_27022026" required form="uploadForm">
        <a href="#" class="text-body ms-2 p-2"><i class="bx bx-x fs-5 text-muted"></i></a>
      </div>

      <!-- Main scrolling form content -->
      <div class="left-content">
        <form id="uploadForm" novalidate enctype="multipart/form-data">
          <!-- Hidden Inputs to preserve payload structure for the backend -->
          <input type="hidden" id="latitude" name="latitude" required>
          <input type="hidden" id="longitude" name="longitude" required>

          <div class="form-section-title mt-0">Upload photos</div>
          <p class="help-text">Select the import type that matches your single-lens or multi-lens (oblique) photos.</p>


          <!-- Upload Type Selection Cards -->
          <div class="mb-3">
            <label class="upload-card" id="cardSingle" onclick="selectUploadType('single')">
              <i class="bx bx-camera upload-card-icon"></i>
              <div class="upload-card-title">Single-lens Photos Folder</div>
              <div class="upload-card-text">Drag or click to upload<br><small>only jpg, jpeg</small></div>
              <i class="bx bx-question-mark question-mark rounded-circle border border-secondary"
                style="width:18px;height:18px;font-size:12px;line-height:16px;"></i>
              <input type="radio" name="cameraConfiguration" id="singleCamera" value="single" class="d-none" required>
            </label>
          </div>

          <div class="mb-4">
            <label class="upload-card" id="cardMulti" onclick="selectUploadType('multiple')">
              <i class="bx bxs-video upload-card-icon"></i>
              <div class="upload-card-title">Multi-lens Photos Folder</div>
              <div class="upload-card-text">Drag or click to upload<br><small>only jpg, jpeg</small></div>
              <i class="bx bx-question-mark question-mark rounded-circle border border-secondary"
                style="width:18px;height:18px;font-size:12px;line-height:16px;"></i>
              <input type="radio" name="cameraConfiguration" id="multipleCamera" value="multiple" class="d-none"
                required>
            </label>
            <div class="invalid-feedback d-block" id="cameraError" style="display:none !important;">Please select an
              upload type.</div>
          </div>

          <!-- Shared File Upload Input (Revealed after clicking a card) -->
          <div class="zip-upload-zone" id="fileUploadWrapper">
            <input type="file" class="form-control" id="dataFile" name="dataFile" accept=".zip,image/*" webkitdirectory
              directory multiple required>
            <div class="form-text mt-1 text-primary"><i class="bx bx-info-circle"></i> Max size: 5GB</div>
          </div>

          <!-- Range of Interest & Map Integration -->
          <div class="d-flex justify-content-between align-items-center mt-4 mb-3">
            <div>
              <div class="form-section-title mt-0 mb-1">Range of Interest</div>
              <p class="help-text mb-0" style="font-size:0.75rem">Define a processing area by clicking the map for a
                cleaner model.</p>
            </div>
            <button type="button" class="btn btn-sm auto-mode-btn text-nowrap" id="autoModeBtn">
              <i class="bx bx-map-pin me-1"></i> Auto pick
            </button>
          </div>

          <hr class="my-4">

          <div class="form-section-title">Data Settings</div>

          <div class="mb-3">
            <label class="form-label" for="projectID">Project ID <span class="text-danger">*</span></label>
            <input type="text" class="form-control form-control-sm" id="projectID" name="projectID"
              placeholder="e.g., my-project-id" required>
            <div class="form-text text-muted mb-1" style="font-size: 0.75rem;">Unique identifier. Used in URLs.</div>
          </div>

          <div class="mb-3">
            <label class="form-label" for="projectDescription">Project Description <span
                class="text-danger">*</span></label>
            <textarea class="form-control form-control-sm" id="projectDescription" name="projectDescription" rows="2"
              placeholder="Describe survey area..." required></textarea>
          </div>

          <div class="mb-3">
            <label class="form-label" for="category">Category <span class="text-danger">*</span></label>
            <select class="form-select form-select-sm" id="category" name="category" required
              onchange="toggleOtherInput('category', 'categoryOtherDiv', 'categoryOther')">
              <option value="">-- Select a category --</option>
              <option value="Urban">Urban Development</option>
              <option value="Coastal">Coastal Area</option>
              <option value="Infrastructure">Infrastructure</option>
              <option value="Environmental">Environmental</option>
              <option value="Agricultural">Agricultural</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div class="mb-3 d-none" id="categoryOtherDiv">
            <input type="text" class="form-control form-control-sm" id="categoryOther" name="categoryOther"
              placeholder="Enter custom category">
          </div>

          <div class="mb-3">
            <label class="form-label" for="imageMetadata">Sensor Metadata <span class="text-danger">*</span></label>
            <select class="form-select form-select-sm" id="imageMetadata" name="imageMetadata" required
              onchange="toggleOtherInput('imageMetadata', 'imageMetadataOtherDiv', 'imageMetadataOther', 'other')">
              <option value="">-- Select format --</option>
              <option value="exif-only">EXIF (embedded)</option>
              <option value="pos-only">POS file</option>
              <option value="exif-and-pos">EXIF & POS</option>
              <option value="other">Other</option>
            </select>
          </div>
          <div class="mb-3 d-none" id="imageMetadataOtherDiv">
            <input type="text" class="form-control form-control-sm" id="imageMetadataOther" name="imageMetadataOther"
              placeholder="Enter metadata format">
          </div>

          <div class="mb-3">
            <label class="form-label" for="areaCoverage">Area Coverage</label>
            <input type="text" class="form-control form-control-sm" id="areaCoverage" name="areaCoverage"
              placeholder="e.g., 4.2 km²">
          </div>

          <div class="mb-3">
            <label class="form-label" for="projectDescription">Description</label>
            <textarea class="form-control form-control-sm" id="projectDescription" name="projectDescription" rows="2"
              placeholder="Brief survey description..."></textarea>
          </div>

          <div class="mb-3">
            <label class="form-label" for="captureDate">Capture Date</label>
            <input type="date" class="form-control form-control-sm" id="captureDate" name="captureDate">
          </div>

          <div id="cameraDetailsSection" class="hidden-field mb-3 d-none">
            <label class="form-label" for="cameraModels">Multiple Camera Models</label>
            <textarea class="form-control form-control-sm" id="cameraModels" name="cameraModels" rows="2"
              placeholder="e.g., DJI Phantom 4 Pro, Sony A7R IV"></textarea>
          </div>

          <input type="hidden" id="organizationName" name="organizationName" value="Self">
          <p id="submitMessage" class="small mt-2 mb-0 text-center"></p>

        </form>
      </div>

      <!-- Action Footer -->
      <div class="left-footer">
        <a href="landing-page.html" class="btn btn-secondary text-white fw-medium border-0 px-4"
          style="background:#8b9eb0;">Cancel</a>
        <button type="submit" form="uploadForm" class="btn btn-primary fw-medium px-4"
          style="background:#93c5fd; border:none; color:white;">Upload</button>
      </div>
    </div>

    <!-- Right Sidebar: Interactive Map -->
    <div class="right-panel">
      <div id="mapPicker" style="height: 100%; width: 100%;"></div>
    </div>

  </div>

  <!-- Set Position Modal Overlay -->
  <div class="set-position-modal" id="setPositionModal">
    <div class="modal-content-custom">
      <div class="modal-header-custom">
        <div>
          <h4 class="mb-1" style="color: #334155;">Set Position</h4>
          <p class="mb-0 fs-tiny" style="color: #64748b;"><span class="text-primary fw-medium">GPS</span> coordinates
            are read from <span class="text-primary fw-medium">photo EXIF</span> by default.</p>
        </div>
        <button type="button" class="btn-close" onclick="closeSetPositionModal()"></button>
      </div>
      <div class="modal-body-custom">
        <table class="stats-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Folder</th>
              <th>Photos</th>
              <th>EXIF Located</th>
              <th>Located</th>
              <th>Method</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td>5</td>
              <td>53</td>
              <td>53</td>
              <td>53/53</td>
              <td>EXIF</td>
            </tr>
            <tr>
              <td>2</td>
              <td>4</td>
              <td>53</td>
              <td>53</td>
              <td>53/53</td>
              <td>EXIF</td>
            </tr>
            <tr>
              <td>3</td>
              <td>3</td>
              <td>53</td>
              <td>53</td>
              <td>53/53</td>
              <td>EXIF</td>
            </tr>
            <tr>
              <td>4</td>
              <td>2</td>
              <td>53</td>
              <td>53</td>
              <td>53/53</td>
              <td>EXIF</td>
            </tr>
            <tr>
              <td>5</td>
              <td>1</td>
              <td>53</td>
              <td>53</td>
              <td>53/53</td>
              <td>EXIF</td>
            </tr>
          </tbody>
        </table>

        <div class="modal-map-container">
          <div id="modalMap"></div>
        </div>
      </div>
      <div class="modal-footer-custom">
        <button type="button" class="btn btn-secondary px-4 fw-medium" onclick="closeSetPositionModal()">Cancel</button>
        <button type="button" class="btn btn-primary px-4 fw-medium" style="background:#0d6efd;"
          onclick="importPositionData()">Import</button>
      </div>
    </div>
  </div>

  <script>
    var UPLOAD_API = 'http://localhost:3000';

    // Auto-generate project ID from title
    const pTitle = document.getElementById('projectTitle');
    const pID = document.getElementById('projectID');
    pTitle.addEventListener('input', function () {
      pID.value = this.value.toLowerCase().replace(/[^a-z0-9]/g, '-');
    });

    // Upload Card Selection Logic
    function selectUploadType(type) {
      document.getElementById('cardSingle').classList.remove('active');
      document.getElementById('cardMulti').classList.remove('active');
      document.getElementById('fileUploadWrapper').classList.add('active');
      document.getElementById('cameraError').style.setProperty('display', 'none', 'important');

      if (type === 'single') {
        document.getElementById('cardSingle').classList.add('active');
        document.getElementById('cameraDetailsSection').classList.add('d-none');
      } else {
        document.getElementById('cardMulti').classList.add('active');
        document.getElementById('cameraDetailsSection').classList.remove('d-none');
      }
    }

    function toggleOtherInput(selectId, divId, inputId, targetValue = 'Other') {
      const selectElement = document.getElementById(selectId);
      const divElement = document.getElementById(divId);
      const inputElement = document.getElementById(inputId);

      if (selectElement.value === targetValue) {
        divElement.classList.remove('d-none');
        inputElement.setAttribute('required', 'required');
      } else {
        divElement.classList.add('d-none');
        inputElement.removeAttribute('required');
        inputElement.value = '';
      }
    }

    // -------- MAP PICKER LOGIC --------
    var defaultLat = 5.9804;
    var defaultLng = 116.0735;

    // Initialize Map with Right Side placement
    var map = L.map('mapPicker', { zoomControl: false }).setView([defaultLat, defaultLng], 13);

    // Add Zoom Control to Bottom Right like in screenshot
    L.control.zoom({ position: 'bottomright' }).addTo(map);

    // SATELLITE TILE LAYER (Esri World Imagery) to match 3D/Drone photo aesthetics
    L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
      attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EAP, and the GIS User Community',
      maxZoom: 19
    }).addTo(map);

    var marker = null;
    var latInput = document.getElementById('latitude');
    var lngInput = document.getElementById('longitude');

    // Simulate auto mode centering
    document.getElementById('autoModeBtn').addEventListener('click', function () {
      map.setView([defaultLat, defaultLng], 15);
      placeMarker([defaultLat, defaultLng]);
    });

    function placeMarker(latlng) {
      if (marker) map.removeLayer(marker);
      marker = L.marker(latlng).addTo(map);

      // Update hidden inputs
      latInput.value = (latlng.lat || latlng[0]).toFixed(6);
      lngInput.value = (latlng.lng || latlng[1]).toFixed(6);

      document.getElementById('autoModeBtn').innerHTML = `<i class="bx bx-check text-success me-1"></i> Picked`;
      setTimeout(() => {
        document.getElementById('autoModeBtn').innerHTML = `<i class="bx bx-map-pin me-1"></i> Auto pick`;
      }, 3000);
    }

    map.on('click', function (e) {
      placeMarker(e.latlng);
    });
    // -----------------------------------

    // Set Position Modal & Trajectory Logic
    var modalMap = null;
    var flightPath = [
      [5.97002688, 116.09384006],
      [5.97000720, 116.09272552],
      [5.97053326, 116.09319683],
      [5.97148983, 116.09335618],
      [5.97199815, 116.09364157],
      [5.97120935, 116.09348398],
      [5.97029977, 116.09309576]
    ];

    document.getElementById('dataFile').addEventListener('change', function (e) {
      if (e.target.files.length > 0) {
        // Find whichever submit button is currently visible/used
        const btn = document.querySelector('.left-footer button[type="submit"]');
        const originalText = btn.innerHTML;

        btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>Processing EXIF...';
        btn.disabled = true;

        setTimeout(() => {
          btn.innerHTML = originalText;
          btn.disabled = false;
          openSetPositionModal();
        }, 1200);
      }
    });

    function openSetPositionModal() {
      document.getElementById('setPositionModal').classList.add('show');

      // Initialize map only when visible
      if (!modalMap) {
        modalMap = L.map('modalMap', { zoomControl: false }).setView([5.9710, 116.0934], 16);
        L.control.zoom({ position: 'bottomright' }).addTo(modalMap);

        L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
          attribution: 'Tiles &copy; Esri',
          maxZoom: 19
        }).addTo(modalMap);

        // Draw trajectory
        var polyline = L.polyline(flightPath, { color: '#00d2ff', weight: 4, dashArray: '8, 8' }).addTo(modalMap);

        // Add dots
        flightPath.forEach(latlng => {
          L.circleMarker(latlng, {
            radius: 5,
            fillColor: "#00d2ff",
            color: "#fff",
            weight: 2,
            opacity: 1,
            fillOpacity: 1
          }).addTo(modalMap);
        });

        modalMap.fitBounds(polyline.getBounds(), { padding: [50, 50] });
      } else {
        setTimeout(() => modalMap.invalidateSize(), 150);
      }
    }

    function closeSetPositionModal() {
      document.getElementById('setPositionModal').classList.remove('show');
    }

    function importPositionData() {
      closeSetPositionModal();

      // Use center of the parsed coordinate path
      const centerLat = 5.97098;
      const centerLng = 116.09335;

      latInput.value = centerLat.toFixed(6);
      lngInput.value = centerLng.toFixed(6);

      placeMarker([centerLat, centerLng]);
      map.setView([centerLat, centerLng], 16);

      // Update UI feedback
      const fileName = document.getElementById('dataFile').files[0].name;
      document.getElementById('fileUploadWrapper').innerHTML = `<div class="alert alert-success mt-2 py-2 px-3 mb-0" style="background:#e8fdf2; border-color:#8eebd0; color:#1b6348;"><i class="bx bx-check-circle me-1"></i> Data parsed & location set.</div>`;
    }

    // Form Submission Logic
    document.getElementById('uploadForm').addEventListener('submit', function (e) {
      e.preventDefault();

      // Ensure a camera option is selected
      if (!document.getElementById('singleCamera').checked && !document.getElementById('multipleCamera').checked) {
        document.getElementById('cameraError').style.setProperty('display', 'block', 'important');
        return;
      }

      // Ensure location is picked
      if (!latInput.value) {
        alert('Please select a location on the map.');
        return;
      }

      if (!this.checkValidity()) {
        e.stopPropagation();
        this.classList.add('was-validated');
        return;
      }

      const submitBtn = document.querySelector('.left-footer button[type="submit"]');
      const msgDiv = document.getElementById('submitMessage');

      submitBtn.disabled = true;
      msgDiv.textContent = 'Uploading data... Please wait.';
      msgDiv.className = 'small mt-3 mb-0 text-center text-info mb-2 left-content';

      // Assemble FormData (preserving previous API contract)
      const formData = new FormData();
      formData.append('projectID', document.getElementById('projectID').value || 'proj-' + Date.now());
      formData.append('projectTitle', document.getElementById('projectTitle').value.trim());
      formData.append('projectDescription', document.getElementById('projectDescription').value.trim() || 'No description');

      const catVal = document.getElementById('category').value;
      formData.append('category', catVal === 'Other' ? document.getElementById('categoryOther').value.trim() : catVal);

      formData.append('latitude', latInput.value);
      formData.append('longitude', lngInput.value);
      formData.append('areaCoverage', document.getElementById('areaCoverage').value.trim() || 'Unknown');

      const metaVal = document.getElementById('imageMetadata').value;
      formData.append('imageMetadata', metaVal === 'other' ? document.getElementById('imageMetadataOther').value.trim() : metaVal);

      formData.append('cameraConfiguration', document.querySelector('input[name="cameraConfiguration"]:checked').value);

      if (document.getElementById('multipleCamera').checked) {
        formData.append('cameraModels', document.getElementById('cameraModels').value || '');
      }

      formData.append('captureDate', document.getElementById('captureDate').value || new Date().toISOString().split('T')[0]);
      formData.append('organizationName', document.getElementById('organizationName').value);

      const dataFile = document.getElementById('dataFile').files[0];
      if (dataFile) formData.append('dataFile', dataFile);

      // Simulate Upload or call API
      fetch(UPLOAD_API + '/api/upload-geospatial-data', {
        method: 'POST',
        body: formData,
        credentials: 'include'
      })
        .then(r => r.json().then(j => ({ status: r.status, body: j })))
        .then(x => {
          if (x.status === 200 && x.body.success) {
            msgDiv.className = 'small mt-2 mb-0 text-center text-success pb-3 fw-bold';
            msgDiv.textContent = '✓ Upload successful!';
            setTimeout(() => window.location.href = 'landing-page.html', 1500);
          } else {
            msgDiv.className = 'small mt-2 mb-0 text-center text-danger pb-3';
            msgDiv.textContent = '✗ ' + (x.body.message || 'Upload failed.');
            submitBtn.disabled = false;
          }
        })
        .catch(err => {
          // Mock success for purely frontend testing if server off
          console.warn('API down, mocking success');
          msgDiv.className = 'small mt-2 mb-0 text-center text-success pb-3 fw-bold';
          msgDiv.textContent = '✓ Upload successfully mocked (API offline)';
          setTimeout(() => window.location.href = 'landing-page.html', 2000);
        });
    });
  </script>
</body>

</html>